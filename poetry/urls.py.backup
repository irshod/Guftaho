from django.urls import path, include
from rest_framework.routers import DefaultRouter
from . import views
from . import views_new
from . import api_views

# API Router
router = DefaultRouter()
router.register(r'poets', api_views.PoetViewSet)
router.register(r'books', api_views.BookViewSet)
router.register(r'poems', api_views.PoemViewSet)

app_name = 'poetry'

urlpatterns = [
    # Main pages
    path('', views_new.home_view, name='home'),
    path('poet/<slug:slug>/', views_new.poet_detail_view, name='poet_detail'),
    path('book/<slug:slug>/', views_new.book_detail_view, name='book_detail'),
    path('book/<slug:book_slug>/poem/<slug:poem_slug>/', views_new.poem_detail_view, name='poem_detail'),
    
    # Search and filtering
    path('search/', views_new.search_view, name='search'),
    path('advanced-search/', views_new.search_view, name='advanced_search'),
    
    # User features (require authentication)
    path('favorites/', views_new.favorites_view, name='favorites'),
    path('reading-history/', views_new.reading_history_view, name='reading_history'),
    path('toggle-favorite/', views_new.toggle_favorite, name='toggle_favorite'),
    
    # Statistics and analytics
    path('statistics/', views_new.statistics_view, name='statistics'),
    
    # API endpoints
    path('api/', include(router.urls)),
    
    # Legacy URLs (for backward compatibility)
    path('legacy/', include([
        path('', views.home_view, name='legacy_home'),
        path('poet/<slug:slug>/', views.poet_detail_view, name='legacy_poet_detail'),
        path('book/<slug:slug>/', views.book_detail_view, name='legacy_book_detail'),
        path('book/<slug:book_slug>/poem/<slug:poem_slug>/', views.poem_detail_view, name='legacy_poem_detail'),
        path('search/', views.search_view, name='legacy_search'),
    ])),
]